---
title: "20191209_OSEAR Prelim Baseline"
author: "Emma"
date: "02/18/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r packages, include=FALSE}
library(tidyverse)
library(here)
library(ggplot2)
library(knitr)
library(lubridate)
library(tableone)
library(forcats)
library(stringr)
library(janitor)
library(plyr)
library(dplyr)
library(qwraps2)
library(gridExtra)
library(rlang)
options(qwraps2_markup = "markdown")
```

## Read in the 6mo data
```{r reading_data, results="hide"}

# Read in 6mo contact data and codebook 
data6 <- read_csv(here::here("Data", "20200311_OSEAR Prelim 6mo data.csv"))
codebook6 <- read_csv(here::here("Data", "20191213_OSEAR 6mo prelim codebook.csv"))

# Fix up column names
colnames(data6) <- colnames(codebook6)
data6 <- data6 %>% 
  dplyr::rename(phonecontact = Colname)

```

## Relabel WHOQOL-BREF responses 
```{r whoqol_relabel}

# Select completed cases + delete extraneous columns
data <- data6 %>% 
  filter(done == 1) %>% 
  select(-colldate, -collid)

# Trying a piped for-loop 
for(var in c('pain', 'med', 'enjoy', 'mean', 'concent', 'safe', 'phys', 'energ', 'appear', 'mon', 'avail', 'leis')) {
    data <- data %>% 
      dplyr::mutate(!!var := case_when(is.na(get(var)) ~ "Missing", 
                                  get(var) == 1 ~ "Not at all", 
                                  get(var) == 2 ~ "A little", 
                                  get(var) == 3 ~ "A moderate amount", 
                                  get(var) == 4 ~ "Very much", 
                                  get(var) == 5 ~ "An extreme amount", 
                                  TRUE ~ "other"))
  }
  
for(var in c('qol', 'satisf', 'getround')) {
  data <- data %>% 
    dplyr::mutate(!!var := case_when(is.na(get(var)) ~ "Missing", 
                                           get(var) == 1 ~ "Very poor", 
                                           get(var) == 2 ~ "Poor", 
                                           get(var) == 3 ~ "Neither poor nor good", 
                                           get(var) == 4 ~ "Good", 
                                           get(var) == 5 ~ "Very good", 
                                           TRUE ~ "other"))
}

for(var in c('sleep', 'adl', 'work', 'self', 'relat', 'sex', 'frenz', 'livplace', 'hserv', 'transport')) {
  data <- data %>% 
    dplyr::mutate(!!var := case_when(is.na(get(var)) ~ "Missing", 
                                     get(var) == 1 ~ "Very dissatisfied", 
                                     get(var) == 2 ~ "Dissatisfied", 
                                     get(var) == 3 ~ "Neither satisfied nor dissatisfied", 
                                     get(var) == 4 ~ "Satisfied", 
                                     get(var) == 5 ~ "Very satisfied", 
                                     TRUE ~ "other"))
}

data <- data %>% 
  mutate(blues = case_when(is.na(blues) ~ "Missing", 
                           blues == 1 ~ "Never", 
                           blues == 2 ~ "Seldom", 
                           blues == 3 ~ "Quite often", 
                           blues == 4 ~ "Very often", 
                           blues == 5 ~ "Always", 
                           TRUE ~ "other"))


```

# WHOQOL-BREF frequency tables
```{r freq_count_tables}

### WHOQOL-BREF
## Very poor to Very good 
pg_data <- data %>%                                  # Select questions that use very poor > Very good answers
  select(qol, satisf, getround) 

pg_ans <- c("Very poor", "Poor", "Neither poor nor good", "Good", "Very good", "Missing", "other") # Answers

pg_func <- function (a) {                            # Create function! 
  a <- factor(a, levels = pg_ans)                    # Level based on answers
  counts <- table(a)                                 # Create frequency count table 
}

pg_tab <- apply(pg_data, 2, pg_func) %>%             # Apply counting function to selected columns(2) 
  t() %>%                                            # Transpose so answers = columns
  as.data.frame()                                    # Store as data frame 

rm(list = c('pg_data', 'pg_ans', 'pg_func'))         # Clean up 

## Not at all -> An extreme amount
nex_data <- data %>% 
  select(pain, med, enjoy, mean, concent, safe, phys, energ, appear, mon, avail, leis)

nex_ans <- c("Not at all", "A little", "A moderate amount", "Very much", "An extreme amount", "Missing", "other") 

nex_func <- function (b) {
  b <- factor(b, levels = nex_ans) 
  counts <- table(b)
}

nex_tab <- apply(nex_data, 2, nex_func) %>% 
  t() %>% 
  as.data.frame()

rm(list = c('nex_data', 'nex_ans', 'nex_func'))

## Very dissatsfied to Very Satisfied  
sat_data <- data %>% 
  select(sleep, adl, work, self, relat, sex, frenz, livplace, hserv, transport)

sat_ans <- c("Very dissatisfied", "Dissatisfied", "Neither satisfied nor dissatisfied", "Satisfied", "Very satisfied", "Missing", "other") 

sat_func <- function (x) {
  x <- factor(x, levels = sat_ans) 
  counts <- table(x) 
}

sat_tab <- apply(sat_data, 2, sat_func) %>% 
  t() %>% 
  as.data.frame()

rm(list = c('sat_data', 'sat_ans', 'sat_func'))

## Mood 
mood_data <- select(data, blues)

mood_tab <- as.data.frame(table(mood_data)) %>% 
  t()

rm(mood_data)

```

# Relabel MSPSS responses + generate frequency counts 
```{r mspss_relabel_count }

for(var in c('soneed', 'soshare', 'famhelp', 'emot', 'comf', 'frhelp', 'count', 'talkfam', 'shfriend', 'specare', 'decis', 'talkfr')) {
  data <- data %>% 
    dplyr::mutate(!!var := case_when(is.na(get(var)) ~ "Missing", 
                                     get(var) == 1 ~ "Very Strongly Disagree", 
                                     get(var) == 2 ~ "Strongly Disagree", 
                                     get(var) == 3 ~ "Mildly Disagree", 
                                     get(var) == 4 ~ "Neutral", 
                                     get(var) == 5 ~ "Mildly Agree", 
                                     get(var) == 6 ~ "Strongly Agree", 
                                     get(var) == 7 ~ "Very Strongly Agree", 
                                     TRUE ~ "other"))
}

mspss_data <- data %>% 
  select(soneed, soshare, famhelp, emot, comf, frhelp, count, talkfam, shfriend, specare, decis, talkfr)

mspss_ans <- c("Very Strongly Disagree", "Strongly Disagree", "Mildly Disagree", "Neutral", "Mildly Agree", "Strongly Agree", "Very Strongly Agree", "Missing", "other") 

mspss_func <- function (m) {
  m <- factor(m, levels = mspss_ans) 
  counts <- table(m) 
}

mspss_tab <- apply(mspss_data, 2, mspss_func) %>% 
  t() %>% 
  as.data.frame()

rm(list = c('mspss_data', 'mspss_ans', 'mspss_func'))

mspss_tab <- mspss_tab %>% 
  select(-other)


```





# Discarded attempts at things 
```{r discards, include = FALSE}

sat_tab <- sapply(colnames(sat_data), function(col) {
  sat_func(sat_data[[col]])
})

sat_tab <- as.data.frame(t(sat_tab))

# Old school individual var mutate way 
data <- data %>% 
  mutate(qol = ifelse(qol == 1, "Very poor", qol)) %>% 
  mutate(qol = ifelse(qol == 2, "Poor", qol)) %>% 
  mutate(qol = ifelse(qol == 3, "Neither poor nor good", qol)) %>% 
  mutate(qol = ifelse(qol == 4, "Good", qol)) %>% 
  mutate(qol = ifelse(qol == 5, "Very good", qol)) %>% 
  mutate(sat = ifelse(sat == 1, "Very poor", sat)) %>% 
  mutate(sat = ifelse(sat == 2, "Poor", sat)) %>% 
  mutate(sat = ifelse(sat == 3, "Neither poor nor good", sat)) %>% 
  mutate(sat = ifelse(sat == 4, "Good", sat)) %>% 
  mutate(sat = ifelse(sat == 5, "Very good", sat)) 

# Individual case_when method
data <- data %>% 
  mutate(pain = case_when(is.na(pain) ~ "missing", 
                              pain == 1 ~ "Not at all", 
                              pain == 2 ~ "A little", 
                              pain == 3 ~ "A moderate amount", 
                              pain == 4 ~ "Very much", 
                              pain == 5 ~ "An extreme amount", 
                              TRUE ~ "other")) %>% 
  mutate(med = case_when(is.na(med) ~ "missing", 
                              med == 1 ~ "Not at all", 
                              med == 2 ~ "A little", 
                              med == 3 ~ "A moderate amount", 
                              med == 4 ~ "Very much", 
                              med == 5 ~ "An extreme amount", 
                              TRUE ~ "other")) %>% 
  mutate(enjoy = case_when(is.na(enjoy) ~ "missing", 
                              enjoy == 1 ~ "Not at all", 
                              enjoy == 2 ~ "A little", 
                              enjoy == 3 ~ "A moderate amount", 
                              enjoy == 4 ~ "Very much", 
                              enjoy == 5 ~ "An extreme amount", 
                              TRUE ~ "other"))
  mutate(mean = case_when(is.na(mean) ~ "missing", 
                              mean == 1 ~ "Not at all", 
                              mean == 2 ~ "A little", 
                              mean == 3 ~ "A moderate amount", 
                              mean == 4 ~ "Very much", 
                              mean == 5 ~ "An extreme amount", 
                              TRUE ~ "other"))

  for (var in c('pain', 'med', 'enjoy')) {
  data <- data %>% 
    mutate(!!var := ifelse(is.na(get(var)) == TRUE, "missing", get(var))) %>%
    mutate(!!var := ifelse(get(var) == 1, "Not at all", get(var))) %>% 
    mutate(!!var := ifelse(get(var) == 5, "An extreme amount", get(var)))
  
}
  
  
# Trying a base R for-loop 

y <- data[,7:18]

data2 <- switch(
  y, 
  1 = "Not at all", 
  2 = "A little", 
  3 = "A moderate amount", 
  4 = "Very much", 
  5 = "An extreme amount"
)

# huhhhhh 

for(var in c("pain", "med", "enjoy")) {
  data3 <- data %>% 
    apply_labels(get(var), 
                 !!var := c("Not at all" = 1, 
                           "A little" = 2, 
                           "A moderate amount" = 3, 
                           "Very much" = 4, 
                           "An extreme amount" = 5)
                 )
}

data3 <- apply_labels(data6, 
                      )


```








